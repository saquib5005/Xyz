import { Component } from '@angular/core';
import { ReactiveFormsModule, FormBuilder, FormGroup, Validators } from '@angular/forms';
import { HttpClient } from '@angular/common/http';
import { Router } from '@angular/router';
import { DropdownModule } from 'primeng/dropdown';
import { InputTextModule } from 'primeng/inputtext';
import { PasswordModule } from 'primeng/password';
import { ButtonModule } from 'primeng/button';
import { CommonModule } from '@angular/common';
import { Store } from '@ngrx/store';
import { setRole } from '../store/role.actions';  // Adjust path if needed

@Component({
  selector: 'app-login',
  standalone: true,
  imports: [CommonModule, ReactiveFormsModule, DropdownModule, InputTextModule, PasswordModule, ButtonModule],  // ← CHANGE: Added PrimeNG modules for components, fixed space in ReactiveFormsModule
  templateUrl: './login.html',
  styleUrls: ['./login.css']
})
export class LoginComponent {

  loginForm: FormGroup;
  roles = [  // ← CHANGE: Changed to PrimeNG format with label/value for p-dropdown
    { label: 'SuperUser', value: 'SuperUser' },
    { label: 'Approver', value: 'Approver' },
    { label: 'User', value: 'User' },
    { label: 'ReadOnly', value: 'ReadOnly' }
  ];

  constructor(private fb: FormBuilder, private http: HttpClient, private router: Router, private store: Store) {
    this.loginForm = this.fb.group({  // ← CHANGE: Fixed missing 'this.' and added Validators for reactive forms
      username: ['', Validators.required],
      password: ['', Validators.required],
      role: ['', Validators.required]
    });
  }

  onSubmit() {
    if (this.loginForm.invalid) {
      return;
    }
    this.http.post('http://localhost:8080/api/auth/login', this.loginForm.value).subscribe({
      next: (response: any) => {
        this.store.dispatch(setRole({ role: response.role }));  // Save to NGRx
        alert('Login successful');  // ← CHANGE: Added alert for feedback
        this.router.navigate(['/home']);
      },
      error: (error) => {
        alert('Login error: ' + error.error);
      }
    });
  }
}

---
<div class="container">
  <h2>Login</h2>
  <form [formGroup]="loginForm" (submit)="onSubmit()">
    <div>
      <label for="username">Username:</label>
      <p-inputText id="username" formControlName="username"></p-inputText>  // ← CHANGE: Changed to p-inputText (PrimeNG) for attractive input
      <p *ngIf="loginForm.get('username')?.invalid">Username is required.</p>  // ← CHANGE: Fixed *ngIf syntax (removed extra ")
    </div>
    <div>
      <label for="password">Password:</label>
      <p-password id="password" formControlName="password"></p-password>  // ← CHANGE: Changed to p-password (PrimeNG) for secure input
      <p *ngIf="loginForm.get('password')?.invalid">Password is required.</p>  // ← CHANGE: Fixed *ngIf syntax
    </div>
    <div>
      <label for="role">Role:</label>
      <p-dropdown id="role" formControlName="role" [options]="roles" optionLabel="label" optionValue="value"></p-dropdown>  // ← CHANGE: Changed to p-dropdown (PrimeNG) for attractive select
      <p *ngIf="loginForm.get('role')?.invalid">Role is required.</p>  // ← CHANGE: Fixed *ngIf syntax
    </div>
    <button type="submit" [disabled]="loginForm.invalid">Login</button>  // ← CHANGE: Kept as button, but you can change to <p-button> if wanted (verify?)
  </form>
</div>

---
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');  /* Import Poppins font – fixed your typo in family */

body {
  font-family: 'Poppins', sans-serif;  /* Overall font for the website */
  margin: 0;
  padding: 0;
  background-color: #f5f5f5;  /* Light grey background – fixed your #f14f4f typo to #f5f5f5 for white-grey */
  height: 100vh;  /* Full viewport height */
  display: flex;
  justify-content: center;
  align-items: center;
}

div {
  background-color: rgb(255, 255, 255);  /* White form background */
  padding: 20px;  /* Fixed your "nax-width" typo to "max-width" */
  max-width: 400px;
  margin: auto;
  border: 1px solid #696868;  /* Light grey border */
  border-radius: 5px;  /* Rounded corners – fixed your 3px to 5px for better look */
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);  /* Subtle shadow – fixed your 2px 10px to softer */
  margin: 20px;  /* Equal padding around the box */
}

h2 {
  color: #4CAF50;  /* Green heading */
  text-align: center;  /* Centered – fixed your left-aligned comment to match standard */
  margin-bottom: 20px;
}

label {
  display: block;
  margin-bottom: 5px;
  color: #333;  /* Dark grey labels */
  text-align: left;  /* Left-aligned */
}

.required {
  color: red;
  font-weight: bold;
}

input, select {
  width: 100%;  /* Full width – fixed your 95% to 100% for clean look */
  padding: 7px;
  margin-bottom: 10px;
  border: 1px solid #ddd;  /* Light grey border */
  border-radius: 5px;
  background-color: #f9f9f9;  /* Very light grey input background – fixed your #fefef */
  color: #333;  /* Dark grey text */
}

input:focus, select:focus {
  border-color: #4CAF50;  /* Green border on focus */
  outline: none;
}

button {
  background-color: #4CAF50;  /* Green button */
  color: white;  /* Fixed your rgb(0,0,0) to white for readability */
  padding: 10px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  width: 100%;
  text-align: center;
}

button:hover {
  background-color: #45a049;  /* Darker green on hover */
}

button:disabled {
  background-color: #ccc;  /* Fixed your #bbb9b9 to #ccc for consistency */
  cursor: not-allowed;
}

p {
  color: red;  /* Fixed your #ee3939 to red for standard errors */
  font-size: 12px;
  margin-top: -5px;
  margin-bottom: 10px;
  text-align: left;
}

---import { Component } from '@angular/core';
import { ReactiveFormsModule, FormBuilder, FormGroup, Validators } from '@angular/forms';
import { HttpClient } from '@angular/common/http';
import { Router } from '@angular/router';
import { DropdownModule } from 'primeng/dropdown';
import { InputTextModule } from 'primeng/inputtext';
import { PasswordModule } from 'primeng/password';
import { ButtonModule } from 'primeng/button';
import { ToastModule } from 'primeng/toast';  // For message alerts
import { CommonModule } from '@angular/common';
import { MessageService } from 'primeng/api';  // For toast messages

@Component({
  selector: 'app-login',
  standalone: true,
  imports: [CommonModule, ReactiveFormsModule, DropdownModule, InputTextModule, PasswordModule, ButtonModule, ToastModule],
  templateUrl: './login.html',
  styleUrls: ['./login.css'],
  providers: [MessageService]  // For toast
})
export class LoginComponent {

  loginForm: FormGroup;
  roles = [
    { label: 'SuperUser', value: 'SuperUser' },
    { label: 'Approver', value: 'Approver' },
    { label: 'User', value: 'User' },
    { label: 'ReadOnly', value: 'ReadOnly' }
  ];

  constructor(private fb: FormBuilder, private http: HttpClient, private router: Router, private messageService: MessageService) {
    this.loginForm = fb.group({
      username: ['', Validators.required],
      password: ['', Validators.required],
      role: ['', Validators.required]
    });
  }

  onSubmit() {
    if (this.loginForm.invalid) {
      this.messageService.add({severity: 'error', summary: 'Error', detail: 'Please fill all fields'});
      return;
    }
    this.http.post('http://localhost:8080/api/auth/login', this.loginForm.value).subscribe({
      next: (response) => {
        this.messageService.add({severity: 'success', summary: 'Success', detail: 'Login successful'});
        this.router.navigate(['/home']);
      },
      error: (error) => {
        this.messageService.add({severity: 'error', summary: 'Error', detail: error.error});
      }
    });
  }
}
-----
<div class="container">
  <h2>Login</h2>
  <form [formGroup]="loginForm" (submit)="onSubmit()">
    <div class="p-field">
      <label for="username">Username:</label>
      <p-inputText id="username" formControlName="username" placeholder="Enter username"></p-inputText>
      <small *ngIf="loginForm.get('username')?.invalid" class="p-error">Username is required.</small>
    </div>
    <div class="p-field">
      <label for="password">Password:</label>
      <p-password id="password" formControlName="password" placeholder="Enter password" [feedback]="false"></p-password>
      <small *ngIf="loginForm.get('password')?.invalid" class="p-error">Password is required.</small>
    </div>
    <div class="p-field">
      <label for="role">Role:</label>
      <p-dropdown id="role" formControlName="role" [options]="roles" optionLabel="label" optionValue="value" placeholder="Select role"></p-dropdown>
      <small *ngIf="loginForm.get('role')?.invalid" class="p-error">Role is required.</small>
    </div>
    <p-button label="Login" type="submit" [disabled]="loginForm.invalid"></p-button>
  </form>
  <p-toast></p-toast>  // PrimeNG toast for messages
</div>

---
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');  /* Import Poppins font */

body {
  font-family: 'Poppins', sans-serif;  /* Overall font for the website */
  margin: 0;
  padding: 0;
  background-color: #f5f5f5;  /* Light grey background for the whole page */
  height: 100vh;  /* Full viewport height */
  display: flex;
  justify-content: center;
  align-items: center;
}

.container {
  background-color: rgb(255, 255, 255);  /* White form background */
  padding: 25px;
  max-width: 400px;
  margin: auto;
  border: 1px solid #696868;  /* Light grey border */
  border-radius: 5px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  margin: 20px;  /* Equal padding around the box */
}

h2 {
  color: #4CAF50;  /* Green heading */
  text-align: center;
  margin-bottom: 20px;
}

.p-field {
  margin-bottom: 15px;
}

label {
  display: block;
  margin-bottom: 5px;
  color: #333;  /* Dark grey labels */
  text-align: left;  /* Left-aligned */
}

.p-error {
  color: #ee3939;  /* Red error messages */
  font-size: 12px;
  margin-top: -5px;
  margin-bottom: 10px;
  text-align: left;
}
